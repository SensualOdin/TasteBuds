// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(cuid())
  email            String    @unique
  name             String
  avatarUrl        String?
  dietaryPrefs     String[]  // vegetarian, vegan, gluten-free, etc
  createdAt        DateTime  @default(now())
  
  groups           GroupMember[]
  swipes           Swipe[]
  createdGroups    Group[]   @relation("GroupCreator")
}

model Group {
  id               String    @id @default(cuid())
  name             String
  code             String    @unique @default(cuid())
  creatorId        String
  creator          User      @relation("GroupCreator", fields: [creatorId], references: [id])
  isActive         Boolean   @default(true)
  sessionActive    Boolean   @default(false)
  radius           Float     @default(5.0) // miles
  latitude         Float?
  longitude        Float?
  priceRange       Int[]     @default([1, 2, 3, 4])
  createdAt        DateTime  @default(now())
  
  members          GroupMember[]
  sessions         Session[]
}

model GroupMember {
  id               String    @id @default(cuid())
  userId           String
  groupId          String
  isReady          Boolean   @default(false)
  joinedAt         DateTime  @default(now())
  
  user             User      @relation(fields: [userId], references: [id])
  group            Group     @relation(fields: [groupId], references: [id])
  
  @@unique([userId, groupId])
}

model Session {
  id               String    @id @default(cuid())
  groupId          String
  status           String    @default("active") // active, completed
  startedAt        DateTime  @default(now())
  completedAt      DateTime?
  
  group            Group     @relation(fields: [groupId], references: [id])
  swipes           Swipe[]
  matches          Match[]
}

model Restaurant {
  id               String    @id @default(cuid())
  placeId          String    @unique // Google Places ID
  yelpId           String?   @unique // Yelp ID
  name             String
  cuisine          String[]
  priceLevel       Int       // 1-4
  rating           Float
  photoUrls        String[]
  address          String
  latitude         Float
  longitude        Float
  phone            String?
  website          String?
  hours            Json?
  
  swipes           Swipe[]
  matches          Match[]
}

model Swipe {
  id               String    @id @default(cuid())
  userId           String
  sessionId        String
  restaurantId     String
  direction        String    // left, right, superlike
  swipedAt         DateTime  @default(now())
  
  user             User      @relation(fields: [userId], references: [id])
  session          Session   @relation(fields: [sessionId], references: [id])
  restaurant       Restaurant @relation(fields: [restaurantId], references: [id])
  
  @@unique([userId, sessionId, restaurantId])
}

model Match {
  id               String    @id @default(cuid())
  sessionId        String
  restaurantId     String
  matchedAt        DateTime  @default(now())
  
  session          Session   @relation(fields: [sessionId], references: [id])
  restaurant       Restaurant @relation(fields: [restaurantId], references: [id])
} 